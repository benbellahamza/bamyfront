<div class="responsable-container">

  <!-- ğŸ” Barre de recherche, filtres dates, boutons -->
  <div class="top-controls">
    <!-- ğŸ” Recherche -->
    <div class="search-zone">
      <input
        type="text"
        placeholder="ğŸ” Rechercher nom, prÃ©nom ou CIN..."
        [(ngModel)]="searchTerm"
        (input)="rechercher()"
        class="search-input"
      >
    </div>

    <!-- ğŸ“… Filtres de date -->
    <div class="date-filters">
      <label>
        Date dÃ©but :
        <input
          type="date"
          [(ngModel)]="startDate"
          (change)="filtrerParDate()"
        >
      </label>

      <label>
        Date fin :
        <input
          type="date"
          [(ngModel)]="endDate"
          (change)="filtrerParDate()"
        >
      </label>
    </div>

    <!-- ğŸ“¤ Boutons Export / Reset -->
    <div class="export-buttons">
      <button class="btn btn-export" (click)="exporterExcel(true)">ğŸ“¤ Exporter tout</button>
      <button class="btn btn-selection" (click)="exporterExcel(false)">ğŸ“¥ Exporter sÃ©lectionnÃ©s</button>
      <button class="btn btn-reset" (click)="resetFiltres()">ğŸ”„ RÃ©initialiser</button>
    </div>
  </div>

  <!-- ğŸ•‘ Loading -->
  <div *ngIf="loading" class="loader">
    Chargement des visiteurs...
  </div>

  <!-- ğŸ§© Grille visiteurs -->
  <div *ngIf="!loading && visiteursFiltres.length > 0" class="visiteurs-grid">
    <div *ngFor="let v of visiteursFiltres" class="visiteur-card">

      <!-- âœ… Header : Checkbox + Nom -->
      <div class="card-header">
        <input
          type="checkbox"
          [checked]="isSelected(v)"
          (change)="toggleSelection(v)"
        >
        <h3>{{ v.nom }} {{ v.prenom }}</h3>
      </div>

      <!-- ğŸ§¾ Body infos -->
      <div class="card-body">
        <p><strong>CIN :</strong> {{ v.cin }}</p>
        <p><strong>Genre :</strong> {{ v.genre }}</p>
        <p><strong>Destination :</strong> {{ v.destination }}</p>
        <p><strong>TÃ©lÃ©phone :</strong> {{ v.telephone || 'N/A' }}</p>
        <p><strong>Type :</strong> {{ v.typeVisiteur || 'Particulier' }}</p>
        <p><strong>Date d'entrÃ©e :</strong> {{ v.dateEntree | date:'short' }}</p>
        <p><strong>Date de sortie :</strong>
          <span *ngIf="v.dateSortie">{{ v.dateSortie | date:'short' }}</span>
          <span *ngIf="!v.dateSortie" class="non-sortie">âŒ Non sorti</span>
        </p>
      </div>

    </div>
  </div>

  <!-- ğŸš« Aucun visiteur trouvÃ© -->
  <div *ngIf="!loading && visiteursFiltres.length === 0" class="no-data">
    ğŸš« Aucun visiteur correspondant aux critÃ¨res.
  </div>

</div>
